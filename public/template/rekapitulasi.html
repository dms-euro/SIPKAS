<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rekapitulasi - Admin Sekolah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9f0',
                            100: '#dbf0db',
                            200: '#b8e0b8',
                            300: '#88ca88',
                            400: '#56ab56',
                            500: '#3d8f3d',
                            600: '#2f712f',
                            700: '#285a28',
                            800: '#234823',
                            900: '#1d3b1d',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Sidebar -->
    <div class="flex">
        <div class="fixed inset-y-0 left-0 bg-white w-64 shadow-lg border-r border-gray-100 transform transition-transform duration-300 ease-in-out z-30">
            <div class="flex items-center justify-center h-16 bg-gradient-to-r from-primary-500 to-primary-700">
                <div class="flex items-center space-x-2">
                    <i class="ri-bank-line text-white text-2xl"></i>
                    <span class="text-white font-bold text-xl">Kas Sekolah</span>
                </div>
            </div>

            <nav class="mt-8 px-4">
                <div class="mb-6">
                    <p class="text-xs uppercase text-gray-500 font-semibold tracking-wider pl-3 mb-2">Menu Utama</p>
                    <a href="admin.html" class="flex items-center py-3 px-3 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                        <i class="ri-dashboard-line mr-3 text-lg"></i>
                        <span class="font-medium">Dashboard</span>
                    </a>
                    <a href="tagihan.html" class="flex items-center py-3 px-3 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                        <i class="ri-bill-line mr-3 text-lg"></i>
                        <span class="font-medium">Tagihan Kas</span>
                    </a>
                    <a href="transaksi.html" class="flex items-center py-3 px-3 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                        <i class="ri-exchange-dollar-line mr-3 text-lg"></i>
                        <span class="font-medium">Konfirmasi Transaksi</span>
                    </a>
                    <a href="rekapitulasi.html" class="flex items-center py-3 px-3 bg-primary-50 text-primary-700 rounded-lg mb-1">
                        <i class="ri-file-chart-line mr-3 text-lg"></i>
                        <span class="font-medium">Rekapitulasi</span>
                    </a>
                </div>

                <div class="mb-6">
                    <p class="text-xs uppercase text-gray-500 font-semibold tracking-wider pl-3 mb-2">Akun</p>
                    <a href="#" class="flex items-center py-3 px-3 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                        <i class="ri-user-line mr-3 text-lg"></i>
                        <span class="font-medium">Profil Saya</span>
                    </a>
                    <a href="#" class="flex items-center py-3 px-3 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                        <i class="ri-logout-box-line mr-3 text-lg"></i>
                        <span class="font-medium">Keluar</span>
                    </a>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="ml-64 flex-1 p-6">
            <!-- Header -->
            <header class="flex justify-between items-center mb-8">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Rekapitulasi Kas</h1>
                    <p class="text-gray-600">Laporan dan analisis data kas sekolah</p>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="exportToPDF()" class="bg-gradient-to-r from-primary-500 to-primary-700 text-white px-5 py-2.5 rounded-lg font-medium flex items-center hover:opacity-90 transition-opacity">
                        <i class="ri-download-line mr-2"></i> Export PDF
                    </button>
                    <div class="flex items-center space-x-3">
                        <div class="h-10 w-10 bg-gradient-to-r from-primary-500 to-primary-700 rounded-full flex items-center justify-center text-white font-bold">A</div>
                    </div>
                </div>
            </header>

            <!-- Filter Laporan -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8">
                <h2 class="text-lg font-bold text-gray-800 mb-4">Filter Laporan</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Periode</label>
                        <select id="periodeSelect" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500" onchange="updateReport()">
                            <option value="bulanan">Per Bulan</option>
                            <option value="tahunan">Per Tahun</option>
                        </select>
                    </div>

                    <div id="bulanField">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Bulan</label>
                        <select id="bulanSelect" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500" onchange="updateReport()">
                            <option value="1">Januari</option>
                            <option value="2">Februari</option>
                            <option value="3">Maret</option>
                            <option value="4">April</option>
                            <option value="5">Mei</option>
                            <option value="6">Juni</option>
                            <option value="7">Juli</option>
                            <option value="8">Agustus</option>
                            <option value="9">September</option>
                            <option value="10">Oktober</option>
                            <option value="11">November</option>
                            <option value="12" selected>Desember</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tahun</label>
                        <select id="tahunSelect" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500" onchange="updateReport()">
                            <option value="2022">2022</option>
                            <option value="2023">2023</option>
                            <option value="2024" selected>2024</option>
                        </select>
                    </div>

                    <div class="flex items-end">
                        <button onclick="updateReport()" class="w-full bg-gradient-to-r from-primary-500 to-primary-700 text-white px-4 py-3 rounded-lg font-medium hover:opacity-90 transition-opacity">
                            <i class="ri-refresh-line mr-2"></i> Muat Laporan
                        </button>
                    </div>
                </div>
            </div>

            <!-- Ringkasan Statistik -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-gradient-to-r from-primary-500 to-primary-700 rounded-xl shadow-lg p-6 text-white">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-primary-100">Total Kas Terkumpul</p>
                            <p class="text-3xl font-bold mt-2" id="totalKas">Rp 12.450.000</p>
                        </div>
                        <div class="bg-white bg-opacity-20 p-3 rounded-lg">
                            <i class="ri-wallet-3-line text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4">
                        <p class="text-primary-100" id="periodeText">November 2024</p>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-green-500 to-green-700 rounded-xl shadow-lg p-6 text-white">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-green-100">Kelas Telah Bayar</p>
                            <p class="text-3xl font-bold mt-2" id="kelasBayar">22 Kelas</p>
                        </div>
                        <div class="bg-white bg-opacity-20 p-3 rounded-lg">
                            <i class="ri-checkbox-circle-line text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4">
                        <p class="text-green-100" id="persentaseBayar">73.3% dari total</p>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-blue-500 to-blue-700 rounded-xl shadow-lg p-6 text-white">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-blue-100">Rata-rata per Kelas</p>
                            <p class="text-3xl font-bold mt-2" id="rataRata">Rp 565.909</p>
                        </div>
                        <div class="bg-white bg-opacity-20 p-3 rounded-lg">
                            <i class="ri-calculator-line text-2xl"></i>
                        </div>
                    </div>
                    <div class="mt-4">
                        <p class="text-blue-100">Dari 30 kelas total</p>
                    </div>
                </div>
            </div>

            <!-- Grafik dan Tabel -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Grafik -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-800">Distribusi Pembayaran per Tingkat</h2>
                    </div>
                    <div id="chartRekap"></div>
                </div>

                <!-- Top 5 Kelas -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">Top 5 Kelas Terbanyak</h2>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="bg-primary-100 text-primary-800 font-bold w-8 h-8 rounded-lg flex items-center justify-center mr-3">1</div>
                                <div>
                                    <p class="font-medium">XII IPA 3</p>
                                    <p class="text-sm text-gray-500">28 siswa</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-primary-600">Rp 7.000.000</p>
                                <p class="text-sm text-gray-500">100%</p>
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-3">
                            <div class="flex items-center">
                                <div class="bg-gray-100 text-gray-800 font-bold w-8 h-8 rounded-lg flex items-center justify-center mr-3">2</div>
                                <div>
                                    <p class="font-medium">XI IPA 2</p>
                                    <p class="text-sm text-gray-500">33 siswa</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-gray-800">Rp 6.600.000</p>
                                <p class="text-sm text-gray-500">94.3%</p>
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-3">
                            <div class="flex items-center">
                                <div class="bg-gray-100 text-gray-800 font-bold w-8 h-8 rounded-lg flex items-center justify-center mr-3">3</div>
                                <div>
                                    <p class="font-medium">XI IPS 1</p>
                                    <p class="text-sm text-gray-500">30 siswa</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-gray-800">Rp 6.000.000</p>
                                <p class="text-sm text-gray-500">85.7%</p>
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-3">
                            <div class="flex items-center">
                                <div class="bg-gray-100 text-gray-800 font-bold w-8 h-8 rounded-lg flex items-center justify-center mr-3">4</div>
                                <div>
                                    <p class="font-medium">X IPA 1</p>
                                    <p class="text-sm text-gray-500">35 siswa</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-gray-800">Rp 5.250.000</p>
                                <p class="text-sm text-gray-500">75%</p>
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-3">
                            <div class="flex items-center">
                                <div class="bg-gray-100 text-gray-800 font-bold w-8 h-8 rounded-lg flex items-center justify-center mr-3">5</div>
                                <div>
                                    <p class="font-medium">X IPS 1</p>
                                    <p class="text-sm text-gray-500">34 siswa</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-gray-800">Rp 5.100.000</p>
                                <p class="text-sm text-gray-500">72.9%</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabel Rekapitulasi -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-8">
                <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800">Detail Rekapitulasi per Kelas</h2>
                    <div class="text-sm text-gray-500">
                        Periode: <span class="font-bold text-gray-800" id="periodeTable">November 2024</span>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kelas</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Wali Kelas</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jumlah Siswa</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tagihan</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Dibayar</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="rekapitulasiTable">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>

                <div class="px-6 py-4 border-t border-gray-100 flex justify-between items-center">
                    <div class="text-sm text-gray-500">
                        Menampilkan <span class="font-medium">30</span> kelas
                    </div>
                    <div class="flex space-x-2">
                        <button class="px-4 py-2 bg-primary-50 text-primary-700 font-medium rounded-lg">Cetak Laporan</button>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <footer class="mt-8 pt-6 border-t border-gray-200 text-center text-gray-500 text-sm">
                <p>Â© 2024 Admin Web Kas Sekolah. Sistem manajemen kas sekolah terintegrasi.</p>
            </footer>
        </div>
    </div>

    <script>
        // Data contoh untuk rekapitulasi
        const rekapitulasiData = [
            { kelas: "X IPA 1", waliKelas: "Budi Santoso, S.Pd.", siswa: 35, tagihan: 5250000, dibayar: 5250000, status: "lunas" },
            { kelas: "X IPA 2", waliKelas: "Siti Aminah, S.Pd.", siswa: 32, tagihan: 4800000, dibayar: 4800000, status: "lunas" },
            { kelas: "X IPA 3", waliKelas: "Agus Wijaya, S.Pd.", siswa: 30, tagihan: 4500000, dibayar: 4500000, status: "lunas" },
            { kelas: "X IPS 1", waliKelas: "Dedi Setiawan, S.Pd.", siswa: 34, tagihan: 5100000, dibayar: 5100000, status: "lunas" },
            { kelas: "X IPS 2", waliKelas: "Eka Putri, S.Pd.", siswa: 33, tagihan: 4950000, dibayar: 4950000, status: "lunas" },
            { kelas: "XI IPA 1", waliKelas: "Fajar Nugroho, S.Pd.", siswa: 31, tagihan: 6200000, dibayar: 6200000, status: "lunas" },
            { kelas: "XI IPA 2", waliKelas: "Gita Maharani, S.Pd.", siswa: 33, tagihan: 6600000, dibayar: 6600000, status: "lunas" },
            { kelas: "XI IPA 3", waliKelas: "Hendra Kurniawan, S.Pd.", siswa: 29, tagihan: 5800000, dibayar: 5800000, status: "lunas" },
            { kelas: "XI IPS 1", waliKelas: "Indah Permata, S.Pd.", siswa: 30, tagihan: 6000000, dibayar: 6000000, status: "lunas" },
            { kelas: "XI IPS 2", waliKelas: "Joko Susilo, S.Pd.", siswa: 32, tagihan: 6400000, dibayar: 6400000, status: "lunas" },
            { kelas: "XII IPA 1", waliKelas: "Kartika Sari, S.Pd.", siswa: 28, tagihan: 7000000, dibayar: 7000000, status: "lunas" },
            { kelas: "XII IPA 2", waliKelas: "Lukman Hakim, S.Pd.", siswa: 30, tagihan: 7500000, dibayar: 7500000, status: "lunas" },
            { kelas: "XII IPA 3", waliKelas: "Maya Indah, S.Pd.", siswa: 28, tagihan: 7000000, dibayar: 7000000, status: "lunas" },
            { kelas: "XII IPS 1", waliKelas: "Nur Hasanah, S.Pd.", siswa: 31, tagihan: 7750000, dibayar: 7750000, status: "lunas" },
            { kelas: "XII IPS 2", waliKelas: "Oki Setiawan, S.Pd.", siswa: 29, tagihan: 7250000, dibayar: 7250000, status: "lunas" },
        ];

        // Chart untuk rekapitulasi
        let chartRekap;

        // Inisialisasi
        document.addEventListener('DOMContentLoaded', function() {
            renderRekapitulasiTable();
            initChart();
            updatePeriodeText();
        });

        // Render tabel rekapitulasi
        function renderRekapitulasiTable() {
            const tableBody = document.getElementById('rekapitulasiTable');
            let html = '';

            rekapitulasiData.forEach(item => {
                const statusColor = item.status === 'lunas' ? 'bg-green-100 text-green-800' :
                                   item.status === 'proses' ? 'bg-yellow-100 text-yellow-800' :
                                   'bg-red-100 text-red-800';
                const statusText = item.status === 'lunas' ? 'Lunas' :
                                  item.status === 'proses' ? 'Proses' : 'Belum';

                html += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="font-medium text-gray-900">${item.kelas}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-gray-900">${item.waliKelas}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-gray-900">${item.siswa} siswa</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-gray-900">Rp ${item.tagihan.toLocaleString('id-ID')}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-gray-900 font-medium">Rp ${item.dibayar.toLocaleString('id-ID')}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">${statusText}</span>
                        </td>
                    </tr>
                `;
            });

            tableBody.innerHTML = html;
        }

        // Inisialisasi chart
        function initChart() {
            const options = {
                series: [44, 55, 41],
                labels: ['Kelas X', 'Kelas XI', 'Kelas XII'],
                chart: {
                    type: 'donut',
                    height: 320
                },
                colors: ['#3d8f3d', '#56ab56', '#88ca88'],
                responsive: [{
                    breakpoint: 480,
                    options: {
                        chart: {
                            width: 200
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }],
                legend: {
                    position: 'bottom',
                    horizontalAlign: 'center'
                }
            };

            chartRekap = new ApexCharts(document.querySelector("#chartRekap"), options);
            chartRekap.render();
        }

        // Update laporan berdasarkan filter
        function updateReport() {
            const periode = document.getElementById('periodeSelect').value;
            const bulan = document.getElementById('bulanSelect').value;
            const tahun = document.getElementById('tahunSelect').value;

            // Update teks periode
            updatePeriodeText();

            // Update data statistik berdasarkan filter (contoh sederhana)
            if (periode === 'bulanan') {
                document.getElementById('totalKas').textContent = 'Rp 12.450.000';
                document.getElementById('kelasBayar').textContent = '22 Kelas';
                document.getElementById('persentaseBayar').textContent = '73.3% dari total';
                document.getElementById('rataRata').textContent = 'Rp 565.909';
            } else {
                document.getElementById('totalKas').textContent = 'Rp 48.500.000';
                document.getElementById('kelasBayar').textContent = '28 Kelas';
                document.getElementById('persentaseBayar').textContent = '93.3% dari total';
                document.getElementById('rataRata').textContent = 'Rp 1.732.143';
            }

            // Update chart (contoh sederhana)
            if (periode === 'bulanan') {
                chartRekap.updateSeries([44, 55, 41]);
            } else {
                chartRekap.updateSeries([30, 40, 30]);
            }
        }

        // Update teks periode
        function updatePeriodeText() {
            const periode = document.getElementById('periodeSelect').value;
            const bulan = document.getElementById('bulanSelect');
            const tahun = document.getElementById('tahunSelect').value;

            const namaBulan = ["Januari", "Februari", "Maret", "April", "Mei", "Juni",
                              "Juli", "Agustus", "September", "Oktober", "November", "Desember"];

            if (periode === 'bulanan') {
                const bulanText = namaBulan[parseInt(bulan.value) - 1];
                document.getElementById('periodeText').textContent = `${bulanText} ${tahun}`;
                document.getElementById('periodeTable').textContent = `${bulanText} ${tahun}`;
            } else {
                document.getElementById('periodeText').textContent = `Tahun ${tahun}`;
                document.getElementById('periodeTable').textContent = `Tahun ${tahun}`;
            }
        }

        // Toggle field bulan berdasarkan periode
        document.getElementById('periodeSelect').addEventListener('change', function() {
            const bulanField = document.getElementById('bulanField');
            if (this.value === 'bulanan') {
                bulanField.classList.remove('hidden');
            } else {
                bulanField.classList.add('hidden');
            }
        });

        // Export to PDF
        function exportToPDF() {
            alert('Fitur export PDF sedang diproses...');
            // Di sini bisa diimplementasikan logika export ke PDF menggunakan jsPDF
            // Contoh:
            // const { jsPDF } = window.jspdf;
            // const doc = new jsPDF();
            // doc.text("Laporan Kas Sekolah", 20, 20);
            // doc.save("laporan-kas.pdf");
        }
    </script>
</body>
</html>
