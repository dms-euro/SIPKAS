<!DOCTYPE html>
<!-- resources/views/admin/saldo/index.blade.php -->
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Saldo - Admin Sekolah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9f0',
                            100: '#dbf0db',
                            200: '#b8e0b8',
                            300: '#88ca88',
                            400: '#56ab56',
                            500: '#3d8f3d',
                            600: '#2f712f',
                            700: '#285a28',
                            800: '#234823',
                            900: '#1d3b1d',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .input-focus:focus {
            border-color: #3d8f3d;
            box-shadow: 0 0 0 3px rgba(61, 143, 61, 0.1);
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <!-- Sidebar -->
    <div class="flex">
        <div
            class="fixed inset-y-0 left-0 bg-white w-64 shadow-lg border-r border-gray-100 transform transition-transform duration-300 ease-in-out z-30">
            <div class="flex items-center justify-center h-16 bg-gradient-to-r from-primary-500 to-primary-700">
                <div class="flex items-center space-x-2">
                    <i class="ri-bank-line text-white text-2xl"></i>
                    <span class="text-white font-bold text-xl">Kas Sekolah</span>
                </div>
            </div>

            <nav class="mt-8 px-4">
                <div class="mb-6">
                    <p class="text-xs uppercase text-gray-500 font-semibold tracking-wider pl-3 mb-2">Menu Utama</p>
                    <a href="{{ route('dashboard.admin') }}"
                        class="flex items-center py-3 px-3 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                        <i class="ri-dashboard-line mr-3 text-lg"></i>
                        <span class="font-medium">Dashboard</span>
                    </a>
                    <a href="{{ route('admin.tagihan.index') }}"
                        class="flex items-center py-3 px-3 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                        <i class="ri-bill-line mr-3 text-lg"></i>
                        <span class="font-medium">Tagihan Kas</span>
                    </a>
                    <a href="{{ route('admin.saldo.index') }}"
                        class="flex items-center py-3 px-3 bg-primary-50 text-primary-700 rounded-lg mb-1">
                        <i class="ri-wallet-line mr-3 text-lg"></i>
                        <span class="font-medium">Manajemen Saldo</span>
                    </a>
                </div>

                <div class="mb-6">
                    <p class="text-xs uppercase text-gray-500 font-semibold tracking-wider pl-3 mb-2">Laporan</p>
                    <a href="{{ route('admin.laporan.bulan') }}"
                        class="flex items-center py-3 px-3 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                        <i class="ri-bar-chart-line mr-3 text-lg"></i>
                        <span class="font-medium">Laporan Bulanan</span>
                    </a>
                    <a href="{{ route('admin.laporan.kelas') }}"
                        class="flex items-center py-3 px-3 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                        <i class="ri-group-line mr-3 text-lg"></i>
                        <span class="font-medium">Laporan per Kelas</span>
                    </a>
                    <a href="{{ route('admin.laporan.belum-bayar') }}"
                        class="flex items-center py-3 px-3 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                        <i class="ri-alert-line mr-3 text-lg"></i>
                        <span class="font-medium">Belum Bayar</span>
                    </a>
                </div>

                <div class="mb-6">
                    <p class="text-xs uppercase text-gray-500 font-semibold tracking-wider pl-3 mb-2">Akun</p>
                    <div class="flex items-center py-3 px-3 text-gray-700">
                        <div
                            class="h-8 w-8 bg-gradient-to-r from-primary-500 to-primary-700 rounded-full flex items-center justify-center text-white font-bold mr-3">
                            {{ strtoupper(substr(auth()->user()->name, 0, 1)) }}
                        </div>
                        <div>
                            <p class="font-medium">{{ auth()->user()->name }}</p>
                            <p class="text-xs text-gray-500 capitalize">{{ auth()->user()->role }}</p>
                        </div>
                    </div>
                    <form method="POST" action="{{ route('logout') }}">
                        @csrf
                        <button type="submit"
                            class="w-full flex items-center py-3 px-3 text-gray-700 hover:bg-gray-100 rounded-lg mb-1">
                            <i class="ri-logout-box-line mr-3 text-lg"></i>
                            <span class="font-medium">Keluar</span>
                        </button>
                    </form>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="ml-64 flex-1 p-6">
            <!-- Header dengan Breadcrumb -->
            <div class="mb-8">
                <nav class="flex mb-4" aria-label="Breadcrumb">
                    <ol class="inline-flex items-center space-x-1 md:space-x-3">
                        <li class="inline-flex items-center">
                            <a href="{{ route('dashboard.admin') }}"
                                class="inline-flex items-center text-sm text-gray-700 hover:text-primary-600">
                                <i class="ri-home-line mr-2"></i>
                                Dashboard
                            </a>
                        </li>
                        <li aria-current="page">
                            <div class="flex items-center">
                                <i class="ri-arrow-right-s-line text-gray-400"></i>
                                <span class="ml-1 text-sm text-primary-600 font-medium md:ml-2">Manajemen Saldo</span>
                            </div>
                        </li>
                    </ol>
                </nav>

                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800">Manajemen Saldo Kas</h1>
                        <p class="text-gray-600">Kelola semua transaksi pemasukan dan pengeluaran kas sekolah</p>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="printTable()"
                                class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center">
                            <i class="ri-printer-line mr-2"></i> Cetak
                        </button>
                    </div>
                </div>
            </div>

            <!-- Flash Messages -->
            @if (session('success'))
                <div class="mb-6 bg-green-50 border border-green-200 rounded-xl p-4" id="successMessage">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="ri-check-line text-green-600"></i>
                        </div>
                        <div>
                            <p class="font-medium text-green-800">Sukses</p>
                            <p class="text-sm text-green-600 mt-1">{{ session('success') }}</p>
                        </div>
                    </div>
                </div>
            @endif

            @if (session('error'))
                <div class="mb-6 bg-red-50 border border-red-200 rounded-xl p-4" id="errorMessage">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="ri-error-warning-line text-red-600"></i>
                        </div>
                        <div>
                            <p class="font-medium text-red-800">Error</p>
                            <p class="text-sm text-red-600 mt-1">{{ session('error') }}</p>
                        </div>
                    </div>
                </div>
            @endif

            <!-- Statistik Saldo -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                @php
                    $totalPemasukan = $saldos->where('tipe', 'pemasukan')->sum('saldo');
                    $totalPengeluaran = $saldos->where('tipe', 'pengeluaran')->sum('saldo');
                    $saldoAkhir = $totalPemasukan - $totalPengeluaran;
                @endphp

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Total Pemasukan</p>
                            <p class="text-2xl font-bold text-green-600">Rp {{ number_format($totalPemasukan, 0, ',', '.') }}</p>
                            <p class="text-xs text-gray-500 mt-1">{{ $saldos->where('tipe', 'pemasukan')->count() }} transaksi</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="ri-arrow-up-line text-green-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Total Pengeluaran</p>
                            <p class="text-2xl font-bold text-red-600">Rp {{ number_format($totalPengeluaran, 0, ',', '.') }}</p>
                            <p class="text-xs text-gray-500 mt-1">{{ $saldos->where('tipe', 'pengeluaran')->count() }} transaksi</p>
                        </div>
                        <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                            <i class="ri-arrow-down-line text-red-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Saldo Akhir</p>
                            <p class="text-2xl font-bold {{ $saldoAkhir >= 0 ? 'text-primary-600' : 'text-red-600' }}">
                                Rp {{ number_format($saldoAkhir, 0, ',', '.') }}
                            </p>
                            <p class="text-xs text-gray-500 mt-1">{{ $saldos->count() }} total transaksi</p>
                        </div>
                        <div class="w-12 h-12 {{ $saldoAkhir >= 0 ? 'bg-primary-100' : 'bg-red-100' }} rounded-lg flex items-center justify-center">
                            <i class="{{ $saldoAkhir >= 0 ? 'ri-wallet-line text-primary-600' : 'ri-alarm-warning-line text-red-600' }} text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form Tambah Transaksi -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-8">
                <div class="bg-gradient-to-r from-primary-50 to-primary-100 px-6 py-4 border-b border-gray-200">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="ri-add-circle-line text-primary-600"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-bold text-gray-800">Tambah Transaksi Manual</h2>
                            <p class="text-sm text-gray-600">Catat pemasukan dari luar atau pengeluaran untuk keperluan sekolah</p>
                        </div>
                    </div>
                </div>

                <div class="p-6">
                    <form action="{{ route('admin.saldo.store') }}" method="POST" id="transaksiForm">
                        @csrf

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <span class="text-red-500">*</span> Tipe Transaksi
                                </label>
                                <div class="grid grid-cols-2 gap-3">
                                    <label class="relative flex cursor-pointer items-center justify-center rounded-lg border border-gray-300 p-4 hover:border-primary-500 transition-colors">
                                        <input type="radio" name="tipe" value="pemasukan" class="peer sr-only" checked>
                                        <div class="text-center">
                                            <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                                                <i class="ri-arrow-up-line text-green-600"></i>
                                            </div>
                                            <span class="text-sm font-medium text-gray-700 peer-checked:text-green-600">Pemasukan</span>
                                        </div>
                                    </label>
                                    <label class="relative flex cursor-pointer items-center justify-center rounded-lg border border-gray-300 p-4 hover:border-primary-500 transition-colors">
                                        <input type="radio" name="tipe" value="pengeluaran" class="peer sr-only">
                                        <div class="text-center">
                                            <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                                                <i class="ri-arrow-down-line text-red-600"></i>
                                            </div>
                                            <span class="text-sm font-medium text-gray-700 peer-checked:text-red-600">Pengeluaran</span>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <span class="text-red-500">*</span> Jumlah (Rp)
                                </label>
                                <input type="number" name="saldo" id="saldo" required min="0" step="1000"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-3 input-focus transition-all"
                                    placeholder="Masukkan jumlah transaksi">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Sumber/Ditujukan Untuk
                                </label>
                                <select name="users_id" class="w-full border border-gray-300 rounded-lg px-4 py-3 input-focus transition-all">
                                    <option value="">-- Pilih Kelas (Opsional) --</option>
                                    @foreach($kelasList as $kelas)
                                        <option value="{{ $kelas->id }}">{{ $kelas->name }}</option>
                                    @endforeach
                                </select>
                                <p class="text-xs text-gray-500 mt-1">Biarkan kosong jika transaksi umum (bukan dari kelas tertentu)</p>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Tagihan Terkait (Opsional)
                                </label>
                                <select name="tagihan_id" class="w-full border border-gray-300 rounded-lg px-4 py-3 input-focus transition-all">
                                    <option value="">-- Pilih Tagihan --</option>
                                    @foreach($tagihanList as $tagihan)
                                        <option value="{{ $tagihan->id }}">{{ $tagihan->nama_tagihan }}</option>
                                    @endforeach
                                </select>
                            </div>

                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <span class="text-red-500">*</span> Keterangan
                                </label>
                                <textarea name="keterangan" id="keterangan" rows="3" required
                                    class="w-full border border-gray-300 rounded-lg px-4 py-3 input-focus transition-all"
                                    placeholder="Contoh: Donasi dari alumni, Pembelian alat tulis, dll"></textarea>
                            </div>
                        </div>

                        <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200 mt-6">
                            <button type="reset"
                                class="px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors">
                                <i class="ri-close-line mr-2"></i> Reset
                            </button>
                            <button type="submit"
                                class="px-6 py-3 bg-gradient-to-r from-primary-500 to-primary-700 text-white font-medium rounded-lg hover:opacity-90 transition-opacity flex items-center">
                                <i class="ri-save-line mr-2"></i> Simpan Transaksi
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Filter Transaksi -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-8">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-800">Filter Transaksi</h3>
                    <p class="text-sm text-gray-600">Filter berdasarkan kriteria tertentu</p>
                </div>
                <div class="p-6">
                    <form action="{{ route('admin.saldo.index') }}" method="GET" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipe</label>
                            <select name="tipe" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 input-focus transition-all">
                                <option value="">Semua Tipe</option>
                                <option value="pemasukan" {{ request('tipe') == 'pemasukan' ? 'selected' : '' }}>Pemasukan</option>
                                <option value="pengeluaran" {{ request('tipe') == 'pengeluaran' ? 'selected' : '' }}>Pengeluaran</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                            <select name="users_id" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 input-focus transition-all">
                                <option value="">Semua Kelas</option>
                                @foreach($kelasList as $kelas)
                                    <option value="{{ $kelas->id }}" {{ request('users_id') == $kelas->id ? 'selected' : '' }}>
                                        {{ $kelas->name }}
                                    </option>
                                @endforeach
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Bulan</label>
                            <select name="bulan" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 input-focus transition-all">
                                <option value="">Semua Bulan</option>
                                @for($i = 1; $i <= 12; $i++)
                                    <option value="{{ $i }}" {{ request('bulan') == $i ? 'selected' : '' }}>
                                        {{ DateTime::createFromFormat('!m', $i)->format('F') }}
                                    </option>
                                @endfor
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tahun</label>
                            <select name="tahun" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 input-focus transition-all">
                                <option value="">Semua Tahun</option>
                                @for($i = date('Y'); $i >= date('Y') - 5; $i--)
                                    <option value="{{ $i }}" {{ request('tahun') == $i ? 'selected' : '' }}>
                                        {{ $i }}
                                    </option>
                                @endfor
                            </select>
                        </div>

                        <div class="md:col-span-4 flex justify-end space-x-3">
                            <a href="{{ route('admin.saldo.index') }}"
                                class="px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                                Reset Filter
                            </a>
                            <button type="submit"
                                class="px-4 py-2.5 bg-gradient-to-r from-primary-500 to-primary-700 text-white rounded-lg hover:opacity-90 transition-opacity flex items-center">
                                <i class="ri-filter-line mr-2"></i> Terapkan Filter
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Daftar Transaksi -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Riwayat Transaksi</h3>
                        <p class="text-sm text-gray-600">Semua catatan pemasukan dan pengeluaran kas sekolah</p>
                    </div>
                    <div class="text-sm text-gray-600">
                        Menampilkan {{ $saldos->count() }} dari {{ $totalTransaksi }} transaksi
                    </div>
                </div>

                @if($saldos->count() > 0)
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200" id="transaksiTable">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Tanggal</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Tipe</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Kelas/Tujuan</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Tagihan</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Keterangan</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Jumlah</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Aksi</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            @foreach ($saldos as $saldo)
                                <tr class="hover:bg-gray-50 transition-colors">
                                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                                        {{ \Carbon\Carbon::parse($saldo->created_at)->format('d M Y H:i') }}
                                    </td>
                                    <td class="px-4 py-3 whitespace-nowrap">
                                        @if($saldo->tipe == 'pemasukan')
                                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                <i class="ri-arrow-up-line mr-1.5"></i>
                                                Pemasukan
                                            </span>
                                        @else
                                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                                <i class="ri-arrow-down-line mr-1.5"></i>
                                                Pengeluaran
                                            </span>
                                        @endif
                                    </td>
                                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                                        @if($saldo->user)
                                            <div class="font-medium text-gray-900">{{ $saldo->user->name }}</div>
                                            <div class="text-xs text-gray-500">{{ $saldo->user->email }}</div>
                                        @else
                                            <span class="text-gray-400">-</span>
                                        @endif
                                    </td>
                                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">
                                        @if($saldo->tagihan)
                                            <div class="font-medium text-gray-900">{{ $saldo->tagihan->nama_tagihan }}</div>
                                            <div class="text-xs text-gray-500">
                                                {{ \Carbon\Carbon::parse($saldo->tagihan->jatuh_tempo)->format('d M Y') }}
                                            </div>
                                        @else
                                            <span class="text-gray-400">-</span>
                                        @endif
                                    </td>
                                    <td class="px-4 py-3 text-sm text-gray-900">
                                        <div class="max-w-xs truncate" title="{{ $saldo->keterangan }}">
                                            {{ $saldo->keterangan }}
                                        </div>
                                    </td>
                                    <td class="px-4 py-3 whitespace-nowrap text-sm font-medium
                                        {{ $saldo->tipe == 'pemasukan' ? 'text-green-600' : 'text-red-600' }}">
                                        {{ $saldo->tipe == 'pemasukan' ? '+' : '-' }}
                                        Rp {{ number_format($saldo->saldo, 0, ',', '.') }}
                                    </td>
                                    <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                                        <div class="flex space-x-2">
                                            <button onclick="editTransaksi({{ $saldo->id }})"
                                                    class="text-blue-600 hover:text-blue-900 flex items-center"
                                                    title="Edit">
                                                <i class="ri-edit-line mr-1"></i>
                                            </button>
                                            <form action="{{ route('admin.saldo.destroy', $saldo->id) }}" method="POST"
                                                  onsubmit="return confirm('Hapus transaksi ini?')">
                                                @csrf
                                                @method('DELETE')
                                                <button type="submit"
                                                        class="text-red-600 hover:text-red-900 flex items-center"
                                                        title="Hapus">
                                                    <i class="ri-delete-bin-line mr-1"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                        <tfoot class="bg-gray-50">
                            <tr>
                                <td colspan="5" class="px-4 py-3 text-right text-sm font-medium text-gray-700">
                                    Total:
                                </td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm font-bold text-gray-900">
                                    Rp {{ number_format($saldoAkhir, 0, ',', '.') }}
                                </td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <!-- Pagination -->
                @if($saldos->hasPages())
                <div class="px-6 py-4 border-t border-gray-200">
                    {{ $saldos->withQueryString()->links() }}
                </div>
                @endif
                @else
                <div class="text-center py-12">
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="ri-file-list-3-line text-gray-400 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Belum ada transaksi</h3>
                    <p class="text-gray-500">Mulai catat transaksi pertama Anda menggunakan form di atas</p>
                </div>
                @endif
            </div>

            <!-- Footer -->
            <footer class="mt-8 pt-6 border-t border-gray-200 text-center text-gray-500 text-sm">
                <p>Â© {{ date('Y') }} Admin Web Kas Sekolah. Sistem manajemen kas sekolah terintegrasi.</p>
            </footer>
        </div>
    </div>

    <!-- Modal Edit Transaksi -->
    <div id="editModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <!-- Modal Header -->
                <div class="flex justify-between items-center pb-3 border-b">
                    <h3 class="text-lg font-semibold text-gray-800">Edit Transaksi</h3>
                    <button onclick="closeEditModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="ri-close-line text-xl"></i>
                    </button>
                </div>

                <!-- Modal Content -->
                <form id="editForm" method="POST">
                    @csrf
                    @method('PUT')

                    <div class="mt-4 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Tipe Transaksi
                            </label>
                            <div class="grid grid-cols-2 gap-3">
                                <label class="relative flex cursor-pointer items-center justify-center rounded-lg border border-gray-300 p-4 hover:border-primary-500 transition-colors">
                                    <input type="radio" name="tipe" value="pemasukan" class="peer sr-only" id="editTipePemasukan">
                                    <div class="text-center">
                                        <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                                            <i class="ri-arrow-up-line text-green-600"></i>
                                        </div>
                                        <span class="text-sm font-medium text-gray-700 peer-checked:text-green-600">Pemasukan</span>
                                    </div>
                                </label>
                                <label class="relative flex cursor-pointer items-center justify-center rounded-lg border border-gray-300 p-4 hover:border-primary-500 transition-colors">
                                    <input type="radio" name="tipe" value="pengeluaran" class="peer sr-only" id="editTipePengeluaran">
                                    <div class="text-center">
                                        <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                                            <i class="ri-arrow-down-line text-red-600"></i>
                                        </div>
                                        <span class="text-sm font-medium text-gray-700 peer-checked:text-red-600">Pengeluaran</span>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Jumlah (Rp)
                            </label>
                            <input type="number" name="saldo" id="editSaldo" required min="0" step="1000"
                                class="w-full border border-gray-300 rounded-lg px-4 py-3 input-focus transition-all">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Keterangan
                            </label>
                            <textarea name="keterangan" id="editKeterangan" rows="3" required
                                class="w-full border border-gray-300 rounded-lg px-4 py-3 input-focus transition-all"></textarea>
                        </div>
                    </div>

                    <!-- Modal Footer -->
                    <div class="flex justify-end space-x-3 pt-4 border-t">
                        <button type="button" onclick="closeEditModal()"
                            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Batal
                        </button>
                        <button type="submit"
                            class="px-4 py-2 bg-gradient-to-r from-primary-500 to-primary-700 text-white rounded-lg hover:opacity-90 transition-opacity">
                            Simpan Perubahan
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Cetak tabel
        function printTable() {
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Laporan Transaksi Kas Sekolah</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #333; text-align: center; }
                        .info { margin-bottom: 20px; padding: 15px; background: #f9f9f9; border-radius: 5px; }
                        .info-item { margin-bottom: 5px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f4f4f4; font-weight: bold; }
                        .pemasukan { color: green; }
                        .pengeluaran { color: red; }
                        .text-right { text-align: right; }
                        .text-center { text-align: center; }
                        .total-row { font-weight: bold; background-color: #f0f0f0; }
                    </style>
                </head>
                <body>
                    <h1>Laporan Transaksi Kas Sekolah</h1>
                    <div class="info">
                        <div class="info-item"><strong>Periode:</strong> {{ request('bulan') ? DateTime::createFromFormat('!m', request('bulan'))->format('F') : 'Semua Bulan' }} {{ request('tahun') ?? date('Y') }}</div>
                        <div class="info-item"><strong>Total Pemasukan:</strong> Rp {{ number_format($totalPemasukan, 0, ',', '.') }}</div>
                        <div class="info-item"><strong>Total Pengeluaran:</strong> Rp {{ number_format($totalPengeluaran, 0, ',', '.') }}</div>
                        <div class="info-item"><strong>Saldo Akhir:</strong> Rp {{ number_format($saldoAkhir, 0, ',', '.') }}</div>
                        <div class="info-item"><strong>Dicetak pada:</strong> ${new Date().toLocaleString('id-ID')}</div>
                    </div>
                    ${document.getElementById('transaksiTable').outerHTML}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Auto hide flash messages after 5 seconds
        setTimeout(() => {
            const successMsg = document.getElementById('successMessage');
            const errorMsg = document.getElementById('errorMessage');

            if (successMsg) successMsg.style.display = 'none';
            if (errorMsg) errorMsg.style.display = 'none';
        }, 5000);

        // Edit transaksi modal
        let currentEditId = null;

        function editTransaksi(id) {
            currentEditId = id;

            // Fetch data transaksi
            fetch(`/saldo/${id}/edit`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const transaksi = data.data;

                        // Set form values
                        if (transaksi.tipe === 'pemasukan') {
                            document.getElementById('editTipePemasukan').checked = true;
                        } else {
                            document.getElementById('editTipePengeluaran').checked = true;
                        }

                        document.getElementById('editSaldo').value = transaksi.saldo;
                        document.getElementById('editKeterangan').value = transaksi.keterangan;

                        // Set form action
                        document.getElementById('editForm').action = `/saldo/${id}`;

                        // Show modal
                        document.getElementById('editModal').classList.remove('hidden');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Terjadi kesalahan saat mengambil data');
                });
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            currentEditId = null;
        }

        // Handle edit form submission
        document.getElementById('editForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            const url = this.action;

            fetch(url, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRF-TOKEN': '{{ csrf_token() }}',
                    'Accept': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.reload();
                } else {
                    alert(data.message || 'Terjadi kesalahan');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Terjadi kesalahan saat menyimpan data');
            });
        });

        // Format input jumlah dengan auto-format
        document.getElementById('saldo').addEventListener('input', function(e) {
            let value = this.value.replace(/[^0-9]/g, '');
            if (value) {
                this.value = parseInt(value).toLocaleString('id-ID');
            }
        });

        document.getElementById('editSaldo').addEventListener('input', function(e) {
            let value = this.value.replace(/[^0-9]/g, '');
            if (value) {
                this.value = parseInt(value).toLocaleString('id-ID');
            }
        });

        // Validasi form sebelum submit
        document.getElementById('transaksiForm').addEventListener('submit', function(e) {
            const saldo = document.getElementById('saldo').value;
            const keterangan = document.getElementById('keterangan').value;

            if (!saldo || parseFloat(saldo.replace(/\./g, '')) <= 0) {
                e.preventDefault();
                alert('Jumlah transaksi harus lebih dari 0');
                return;
            }

            if (!keterangan.trim()) {
                e.preventDefault();
                alert('Keterangan harus diisi');
                return;
            }
        });
    </script>
</body>

</html>
